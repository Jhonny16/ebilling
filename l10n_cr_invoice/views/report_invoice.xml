<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="l10n_cr_report_invoice_document" inherit_id="account.report_invoice_document">
        <xpath expr="//t[@t-set='o']" position="after">
            <t t-set="is_l10n_cr_invoice"
               t-value="o.l10n_cr_fiscal_journal and o.company_id.country_id and o.company_id.country_code == 'CR'"/>
        </xpath>

        <!-- Hide when l10n cr invoice -->
        <xpath expr="//div[hasclass('page')]/t[@t-set='layout_document_title']" position="attributes">
            <attribute name="t-if">not is_l10n_cr_invoice</attribute>
        </xpath>
        <xpath expr="///div[hasclass('page')]//div[@id='payment_term']//p[@name='payment_communication']" position="attributes">
            <attribute name="t-if">not is_l10n_cr_invoice</attribute>
        </xpath>
        <xpath expr="//div[@class='row']" position="attributes">
            <attribute name="t-if">not is_l10n_cr_invoice</attribute>
        </xpath>

        <xpath expr="//div[@class='row']" position="before">
            <div class="row" t-if="is_l10n_cr_invoice">
                <!-- Show when l10n cr invoice -->
                <div id="cr_informations" class="col-7 mt36 mb32 mr8">

                    <!-- Company info -->
                    <!-- Fiscal info -->
                    <div class="col-12">
                        <h3>
                            <t t-if="o.state == 'draft'">
                                Borrador
                                <br/>
                            </t>
                            <t t-if="o.state == 'cancel'">
                                Anulada
                                <br/>
                            </t>
                            <span t-field="o.voucher_type_id.name"/>
                            <br/>
                            <span t-if="o.name" style="font-size:22px; !important;margin:0px;padding:0px 0px;">
                                <strong>
                                    <span t-if="o.name != '/'" t-field="o.name"/>
                                </strong>
                            </span>
                        </h3>
                        <div t-if="o.document_id" name="l10n_cr_consecutive">
                            <strong>Consecutive:</strong>
                            <p class="m-0" t-field="o.document_id.number"/>
                        </div>
                        <div t-if="o.document_id" name="l10n_cr_key_numeric">
                            <strong>Numeric Key:</strong>
                            <p class="m-0" t-field="o.document_id.name"/>
                        </div>
                        <div class="l10n_cr_key_numeric_ref"
                            t-if="(o.move_type == 'out_refund' or o.move_type == 'in_refund' or o.debit_origin_id) and (o.numero_ref != False)">
                            <strong>Numeric Key Modified:</strong>
                            <p class="m-0" t-field="o.numero_ref"/>
                        </div>
                    </div>
                </div>
                <div class="col-5">
                    <div name="no_shipping">
                        <address>
                            <span style="color:#111 !important;" t-field="o.partner_id"/>
                            <br/>
                            <span t-if="o.partner_id.vat" style="color:#111 !important;">Identification Number:
                                <t t-esc="o.partner_id.vat"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.phone" style="color:#111 !important;">
                                <i class="fa fa-phone"/>
                                <t t-esc="o.partner_id.phone"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.mobile" style="color:#111 !important;">
                                <i class="fa fa-mobile"/>
                                <t t-esc="o.partner_id.mobile"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.email" style="color:#111 !important;">
                                <i class="fa fa-envelope"/>
                                <t t-esc="o.partner_id.email"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.street" style="color:#111 !important;"><t
                                    t-esc="o.partner_id.street"/>,
                            </span>
                            <span t-if="o.partner_id.street2" style="color:#111 !important;"><t
                                    t-esc="o.partner_id.street2"/>.
                                <br/>
                            </span>
                            <span t-if="o.partner_id.city" style="color:#111 !important;">
                                <t t-esc="o.partner_id.city"/>
                                ,
                            </span>
                            <span t-if="o.partner_id.country_id.name" style="color:#111 !important;">
                                <t t-esc="o.partner_id.country_id.name"/>
                            </span>
                            <br/>
                            <span t-if="o.partner_id.commercial_name" style="color:#111 !important;">Commercial Name:
                                <t t-esc="o.partner_id.commercial_name"/>
                                <br/>
                            </span>
                            <span t-if="o.partner_id.l10n_cr_activity_id" style="color:#111 !important;">Economic Activity:
                                <t t-esc="o.partner_id.l10n_cr_activity_id.code"/>
                                <br/>
                            </span>
                        </address>
                    </div>
                    <div name="shipping_address_block" groups="account.group_delivery_invoice_address">
                        <strong>Dirección de entrega:</strong>
                        <p t-field="o.partner_shipping_id.name">Shipping Name</p>
                    </div>
                </div>
            </div>
        </xpath>
        <xpath expr="//div[@id='informations']" position="inside">
            <div t-attf-class="#{'col-auto col-3 mw-100' if report_type != 'html' else 'col'} mb-2" name="l10n_cr_payment_term"
                 t-if="is_l10n_cr_invoice">
                <strong>Condition Sale:</strong>
                <br/>
                <p class="m-0" t-esc="o.invoice_payment_term_id.payment_type_id.name or 'Contado'"/>
            </div>
            <div t-attf-class="#{'col-auto col-3 mw-100' if report_type != 'html' else 'col'} mb-2"
                 t-if="o.currency_id and is_l10n_cr_invoice" name="l10n_cr_currency">
                <strong>Currency:</strong>
                <br/>
                <p class="m-0" t-esc="o.currency_id.name"/>
                <t t-set="display_exchange" t-value="o.currency_id.name != 'CRC'"/>
                <t t-if="display_exchange">
                    (<span t-field="o.currency_rate"
                           t-options='{"widget": "monetary", "display_currency": o.company_id.currency_id}'/>)
                </t>
            </div>
        </xpath>
        <xpath expr="//div[@id='qrcode']" position="after">
            <div t-if="is_l10n_cr_invoice">
                <div>
                    <img t-if="o.QR_code" t-att-src="image_data_uri(o.QR_code)" alt="Logo"
                         width="150" height="150" class="media-object"/>
                </div>
            </div>
        </xpath>
        <xpath expr="//div[@id='right-elements']/.." position="inside">
            <t t-if="is_l10n_cr_invoice">
                <div class="mb-3" t-if="o.move_type in ('out_invoice', 'in_refund') and o.payment_reference">
                    <p name="payment_communication">
                        Payment Communication: <span class="fw-bold" t-field="o.payment_reference">INV/2023/00001</span>
                        <t t-if="o.partner_bank_id">
                            <br/> on this account: <span t-field="o.partner_bank_id" class="fw-bold"/>
                        </t>
                    </p>
                </div>

                <div class="mt-2" name="l10n_cr_quantity_lines">
                    <div>CANT. ARTICULO (S):
                        <t t-esc="len(lines)"/>
                    </div>
                </div>
                <br/>
                <div t-if="o.state == 'posted'">
                    <p align="center">
                        Emitida conforme lo establecido en la resolución de Facturación Electrónica,
                        <br/>
                        MH-DGT-RES-0027-2024 del 19 de noviembre de 2024 de la Dirección General de Tributación Directa.
                    </p>
                </div>
            </t>
        </xpath>
        <xpath expr="//div[@id='right-elements']/div/div/table[hasclass('o_total_table')]/t" position="before">
            <tr t-if="display_discount">
                <td>Total Discount</td>
                <td class="text-end">
                    <span t-field="o.amount_discount"
                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>
                </td>
            </tr>
        </xpath>
    </template>
    <template id="document_tax_totals_company_currency_template_inherit"
              inherit_id="account.document_tax_totals_company_currency_template">

        <xpath expr="//div[hasclass('totals_taxes_company_currency')]" position="attributes">
            <attribute name="t-if">not is_l10n_cr_invoice</attribute>
        </xpath>
    </template>
<!--    <template id="l10n_cr_document_tax_totals_template" inherit_id="account.document_tax_totals_template">-->
<!--        <xpath expr="//tr[@class='o_subtotal']" position="after">-->
<!--            <t t-set="display_exonerated" t-value="is_l10n_cr_invoice and o.l10n_cr_has_exoneration and o.amount_exonerated and o.state == 'posted'"/>-->
<!--            <tr t-if="display_exonerated">-->
<!--                <td>Exonerado</td>-->
<!--                <td class="text-end">-->
<!--                    <span t-field="o.amount_exonerated" t-att-class="oe_subtotal_footer_separator"-->
<!--                          t-options='{"widget": "monetary", "display_currency": o.currency_id}'/>-->
<!--                </td>-->
<!--            </tr>-->
<!--        </xpath>-->
<!--    </template>-->
</odoo>



