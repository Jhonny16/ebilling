<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="view_partner_form" model="ir.ui.view">
        <field name="name">res.partner.form.inherit</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.view_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//field[@name='company_type']" position="replace"/>
            <xpath expr="//field[@name='name']" position="after">
                <field class="oe_edit_only" name="company_type" options="{'horizontal': true}" widget="radio"/>
            </xpath>
            <field name="name" position="after">
                <field name="commercial_name" help="Si difiere de la razón social" placeholder="Nombre Comercial"
                       invisible="'CR' not in fiscal_country_codes"/>
            </field>
            <field name="state_id" position="attributes">
                <attribute name="options">{"no_open": True, "no_create": 1, "no_create_edit": 1}</attribute>
            </field>
            <field name="vat" position="before">
                <field name="identification_id" options="{'no_open': 1,'no_create': 1, 'no_create_edit': 1}"
                       invisible="'CR' not in fiscal_country_codes"/>
<!--                <field name="l10n_cr_activity_id" options="{'no_open': 1,'no_create': 1, 'no_create_edit': 1}"-->
<!--                       invisible="'CR' not in fiscal_country_codes"/>-->
            </field>
            <xpath expr="//div[hasclass('o_address_format')]/.." position="inside">
                <field name="l10n_cr_exoneration_authorization" invisible="'CR' not in fiscal_country_codes"/>
            </xpath>
            <field name="vat" position="attributes">
                <attribute name="required">identification_id != False</attribute>
            </field>
            <xpath expr="//form/sheet/notebook" position="before">
                <group invisible="'CR' not in fiscal_country_codes">
                    <group>
                        <separator colspan="7"/>
                        <field name="l10n_cr_activity_id"/>
                    </group>
                </group>
            </xpath>
            <xpath expr="//page[3]" position="after">
                <page name="exoneration_config" string="Exoneration" invisible="l10n_cr_exoneration_authorization != True">
                    <group>
                        <group>
                            <field name="l10n_cr_exoneration_name" invisible="1"/>
                            <label for="l10n_cr_document_number" class="oe_inline" string="N°Documento"/>
                            <div>
                                <field name="l10n_cr_document_number" class="oe_inline"/>
                                <button type="object"
                                    name="search_exoneration_document" class="btn-link py-0">
                                    <i class="oi oi-search"/>
                                    Buscar
                                </button>
                            </div>
<!--                            <field name="l10n_cr_document_number"/>-->
                            <field name="l10n_cr_document_type_id"/>
                            <field name="l10n_cr_institution_name"/>
                        </group>
                        <group>
                            <field name="l10n_cr_issue_date"/>
                            <label for="l10n_cr_percentage_exoneration"/>
                            <div>
                                <field name="l10n_cr_percentage_exoneration" class="oe_inline"/>%
                            </div>
                            <field name="l10n_cr_date_expiration" invisible="'CR' not in fiscal_country_codes"/>
                            <field name="tax_id" requited="l10n_cr_exoneration_authorization"
                            domain="[('is_exonerated','=',True)]" context="{'default_is_exonerated': True}"/>
                        </group>
                    </group>
                    <field name="l10n_cr_allowed_cabys_ids">
                        <list editable="bottom" decoration-warning="cabys_code != exoneration_code">
                            <field name="parent_id" column_invisible="1" context="{'default_parent_id': id}"/>
                            <field name="product_id" column_invisible="1"/>
                            <field name="cabys_code" readonly="False" column_invisible="1"/>
                            <field name="exoneration_code"/>
                        </list>
                    </field>
                </page>
            </xpath>
            <xpath expr="//div[hasclass('alert')]" position="after">
                <div class="alert alert-warning" role="alert"
                     invisible="l10n_cr_exoneration_state != 'close_to_expiring'">
                    Warning: this exoneration is next to expire on.
                </div>
                <div class="alert alert-warning" role="alert"
                     invisible="l10n_cr_exoneration_state != 'expired'">
                    Warning: this exoneration is expired.
                </div>
            </xpath>
        </field>
    </record>
</odoo>
