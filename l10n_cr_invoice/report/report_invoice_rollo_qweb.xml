<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="external_layout_rollo">
        <div class="header"/>
        <div class="article" t-att-data-oe-model="o and o._name" t-att-data-oe-id="o and o.id"
             t-att-data-oe-lang="o and o.env.context.get('lang')">
            <t t-raw="0"/>
        </div>
        <div class="footer"/>
    </template>

    <template id="external_layout_ai_rollo">
        <t t-call="l10n_cr_invoice.external_layout_rollo">
            <t t-raw="0"/>
        </t>
    </template>

    <template id="ai_rollo_payment">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-set="lang"
                   t-value="o.user_id.lang if o.move_type in ('in_invoice', 'in_refund') else o.partner_id.lang"/>
                <t t-set="o" t-value="o.with_context({'lang':lang})"/>
                <t t-call="l10n_cr_invoice.external_layout_ai_rollo">
                    <div class="page">
                        <style>
                            @font-face {
                            font-family: 'Inconsolata';
                            font-style: normal;
                            src: url('l10n_cr_invoice/static/src/fonts/inconsolata-regular.ttf') format('ttf'),
                            url('l10n_cr_invoice/static/src/fonts/inconsolata-regular.ttf') format('truetype'),
                            url('l10n_cr_invoice/static/src/fonts/inconsolata.otf') format('otf');
                            }
                            .page {
                            font-family: 'Inconsolata' !important;
                            font-weight: bold;
                            line-height : normal !important;
                            }
                            .table {
                            margin-bottom : 0px !important;
                            line-height : normal !important;
                            }
                            .pos-disc-font {
                            font-size: 12px;
                            font-style:italic;
                            color: #808080;
                            }
                        </style>
                        <p style="text-align: center;">
                            <!--img t-att-src="'data:image/png;base64,%s' % to_text(o.company_id.logo)" style="max-height:2cm; max-width:100%;" t-if="o.company_id.logo"/-->
                            <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)" alt="Logo"
                                 style="max-height:2cm; max-width:100%;"/>
                        </p>
                        <div class="text-center" style="text-align: center;">
                            <h4 style="text-align: center;">
                                <span style="color:#111 !important;text-transform:uppercase;"
                                      t-field="o.company_id.partner_id"/>
                            </h4>
                            <!--<h4>EMPRESA S.A.</h4>-->
                            <span t-if="o.company_id.vat" style="color:#111 !important;">RUT:
                                <t t-esc="o.company_id.vat"/>
                                <br/>
                            </span>
                            <span t-if="o.company_id.partner_id.phone"
                                  style="color:#111 !important; text-transform:uppercase;">
                                <i class="fa fa-phone"/>
                                <t t-esc="o.company_id.partner_id.phone"/>
                            </span>
                            <span t-if="o.company_id.partner_id.mobile"
                                  style="color:#111 !important; text-transform:uppercase;">
                                <i class="fa fa-mobile"/>
                                <t t-esc="o.company_id.partner_id.mobile"/>
                                <br/>
                            </span>
                        </div>
                        <div style="text-align: center;">
                            <h4 style="text-align: center;">FACTURA ELECTRÓNICA</h4>
                            <div>
                                <span>
                                    CLAVE NUMÉRICA:
                                    <span t-if="o.document_id.name" t-field="o.document_id.name"/>
                                    <br/>
                                    CONSECUTIVO:
                                    <span t-if="o.document_id.number" t-field="o.document_id.number"/>
                                </span>
                            </div>
                            <div>FECHA FACTURA:
                                <t t-esc="o.invoice_date" t-options='{"widget": "date"}'/>
                            </div>

                            <t t-if="o.user_id">
                                <div>VENDEDOR:
                                    <t t-esc="o.user_id.name"/>
                                </div>
                            </t>

                            <t t-if="o.partner_id">
                                <div>CLIENTE:
                                    <t t-esc="o.partner_id.name"/>
                                </div>
                                <t t-if="o.partner_id">
                                    <div>CEDULA:
                                        <t t-esc="o.partner_id.vat"/>
                                    </div>
                                </t>
                                <t t-if="o.partner_id.street">
                                    <div>DIRECCION:
                                        <t t-esc="o.partner_id.street"/>
                                    </div>
                                </t>
                                <t t-if="o.partner_id.phone">
                                    <div>TELEFONO:
                                        <t t-esc="o.partner_id.phone"/>
                                    </div>
                                </t>
                                <t t-if="o.partner_id.email">
                                    <div>EMAIL:
                                        <t t-esc="o.partner_id.email"/>
                                    </div>
                                </t>
                            </t>
                            <t t-if="o.name">
                                <div>ORDEN COMPRA:
                                    <t t-esc="o.name"/>
                                </div>
                            </t>
                        </div>
                        <table class="table table-sm o_main_table">
                            <thead>
                                <tr>
                                    <th style="width: 60%">
                                        Descripción<br/>Cant./Precio Unit.
                                    </th>
                                    <th style="width: 40%" class="text-right">
                                        TOTAL
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-set="counter" t-value="0"/>
                                <t t-foreach="o.invoice_line_ids" t-as="line">
                                    <tr>
                                        <td style="text-transform:uppercase;">
                                            <t t-esc="line.name"/>
                                            <span t-if="line.tax_ids">[*]</span>
                                            <br/>
                                            <t t-if="line.discount &gt; 0">
                                                <div class="pos-disc-font">
                                                    Con un<span t-field="line.discount"/>% de descuento
                                                </div>
                                            </t>
                                            <span t-esc="line.quantity"/>
                                            X
                                            <span t-esc="line.price_unit"/>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="line.price_subtotal"
                                                  t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;o.currency_id&quot;}"/>
                                        </td>
                                    </tr>
                                    <t t-set="counter" t-value="counter + 1"/>
                                </t>
                            </tbody>
                        </table>

                        <div t-if="o.narration">
                            <strong>COMMENT:</strong>
                            <span t-field="o.narration"/>
                            <br/>
                        </div>
                        <div t-if="o.fiscal_position_id.note">
                            <strong>FISCAL POSITION:</strong>
                            <span t-field="o.fiscal_position_id.note"/>
                            <br/>
                        </div>
                        <br/>
                        <!-- <div class="row" name="codigo de control"> -->
                        <div class="row" align="right">
                            <div class="col-sm-12">
                                <!-- <div class="col-xs-8 pull-right" align="right"> -->
                                <!-- <table class="table table-condensed" name="totals"> -->
                                <table class="table table-sm" name="totals">
                                    <tr>
                                        <td>
                                            <strong>SUBTOTAL</strong>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="o.amount_untaxed"
                                                  t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;o.currency_id&quot;}"/>
                                        </td>
                                    </tr>
                                    <!--Tax totals-->
                                    <t t-set="tax_totals" t-value="o.tax_totals"/>
                                    <t t-foreach="tax_totals['subtotals']" t-as="subtotal">
                                        <tr class="border-black o_subtotal">
                                            <td>
                                                <strong t-esc="subtotal['name']"/>
                                            </td>
                                            <td class="text-right">
                                                <span
                                                        t-att-class="oe_subtotal_footer_separator"
                                                        t-esc="subtotal['formatted_amount']"
                                                />
                                            </td>
                                        </tr>
                                        <t t-set="subtotal_to_show" t-value="subtotal['name']"/>
                                        <t t-call="account.tax_groups_totals"/>
                                    </t>
                                    <tr class="border-black" t-if="o.amount_discount &gt; 0">
                                        <td>
                                            <strong>Descuento</strong>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="o.amount_discount"
                                                  t-field-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: &quot;o.currency_id&quot;}"/>
                                        </td>
                                    </tr>
                                    <tr class="border-black">
                                        <td>
                                            <strong>TOTAL</strong>
                                        </td>
                                        <td  class="text-right">
                                        <span t-esc="tax_totals['formatted_amount_total_rounded']" t-if="'formatted_amount_total_rounded' in tax_totals"/>
                                        <span t-esc="tax_totals['formatted_amount_total']" t-else=""/>
                                    </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <br/>[*] = PRODUCTOS CON I.V.A.
                        <br/>
                        <div class="text-center" style="text-align: center;">______________________________
                            <br/>
                            RECIBIDO CONFORME
                            <br/>
                            <b>Emitida conforme lo establecido en la Resolución de Facturación Electrónica,
                                DGT-R-033-2019 del 20 de junio de 2019 de la Dirección General de Tributación Directa.
                            </b>
                        </div>
                        <br/>
                        <!--center>
                          <img t-if="o.image_qr" t-att-src="image_data_uri(o.image_qr)" alt="Logo" style="max-height:2.5cm; max-width:100%;"/>
                        </center-->
                        <center>
                            <t t-if="o.document_id.name">
                                <br/>
                                <div t-field="o.document_id.name" style="padding:0;text-align: center;"
                                     t-options="{'widget': 'barcode', 'symbology': 'auto', 'img_style': 'width:130mm;height:25mm'}"/>
                                <span class="text-center" t-field="o.document_id.name"/>
                            </t>
                        </center>
                    </div>
                </t>
            </t>
        </t>
    </template>
</odoo>
